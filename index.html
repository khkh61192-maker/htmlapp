<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å‚µåˆ¸è³ªæŠ¼ç®¡ç† App - V2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html { -webkit-text-size-adjust: 100%; height: 100%; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            -webkit-tap-highlight-color: transparent;
            min-height: 100vh;
        }
        .safe-area-top { padding-top: env(safe-area-inset-top); }
        .safe-area-bottom { padding-bottom: calc(env(safe-area-inset-bottom) + 1rem); }
        
        /* åœ–ç‰‡æå–çš„è—è‰²: #3B7695 */
        .bg-theme-blue { background-color: #3B7695; }
        .text-theme-blue { color: #3B7695; }

        .tab-btn { padding: 0.6rem 0.4rem; font-size: 0.85rem; font-weight: 500; border-radius: 0.75rem; transition: all 0.2s; min-width: 65px; color: #64748b; }
        .tab-btn.active { background-color: #3B7695; color: white !important; font-weight: 700; box-shadow: 0 4px 10px -2px rgb(59 118 149 / 0.4); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input, select, textarea { -webkit-appearance: none; appearance: none; }
        
        @keyframes modalIn {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        .modal-animate { animation: modalIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 pb-32">

    <!-- Header (Theme Blue) -->
    <nav class="bg-theme-blue text-white shadow-lg sticky top-0 z-30 safe-area-top">
        <div class="max-w-md mx-auto p-4 flex justify-between items-center">
            <h1 class="font-bold text-lg tracking-tight">å‚µåˆ¸æŠ•è³‡è³ªæŠ¼ (V2026)</h1>
            <div class="flex items-center space-x-3">
                <button onclick="exportData()" class="text-sm bg-white/20 px-3 py-1 rounded-full font-medium">å‚™ä»½</button>
                <button onclick="openSettingsModal()" class="text-sm bg-white/20 px-3 py-1 rounded-full font-medium">è¨­å®š</button>
            </div>
        </div>
    </nav>

    <div class="max-w-md mx-auto p-4 space-y-4">
        <!-- ç¸½è¦½å¡ç‰‡ (æ•¸æ“šä¿ç•™é›è—è‰² Indigo) -->
        <div class="bg-white rounded-[2.5rem] p-7 shadow-sm border border-slate-100">
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-4">Portfolio Overview</p>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <p class="text-xs text-slate-400 mb-1">åœ‹å…§æŒå€‰ (å¼µ)</p>
                    <h2 id="totalBonds" class="text-3xl font-black text-indigo-600">0</h2>
                </div>
                <div>
                    <p class="text-xs text-slate-400 mb-1">ç¸½é ä¼°æç›Š</p>
                    <h2 id="totalProfitLoss" class="text-3xl font-black text-indigo-600">$0</h2>
                </div>
            </div>

            <div class="space-y-3 pt-5 border-t border-slate-50 text-sm">
                <div class="flex justify-between">
                    <span class="text-slate-500">00720B ç›®å‰å¸‚åƒ¹</span>
                    <span id="domesticPriceDisplay" onclick="openPriceModal()" class="font-bold text-indigo-600 underline decoration-dotted pointer-cursor">$0.00</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-500">åœ‹å¤–å‚µåˆ¸ç¸½å¸‚å€¼</span>
                    <span id="totalOverseasValueDisplay" class="font-semibold text-slate-700">$0</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-500">ç´¯è¨ˆé…æ¯æ”¶å…¥</span>
                    <span id="totalDividends" class="font-semibold text-emerald-600">$0</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-500">é ä¼°è³ªæŠ¼åˆ©æ¯</span>
                    <span id="totalInterest" class="font-semibold text-rose-500">-$0</span>
                </div>
                <div class="flex justify-between pt-2 border-t font-bold text-slate-700">
                    <span>ç¸½æŠ•å…¥æˆæœ¬</span>
                    <span id="totalCost">$0</span>
                </div>
                <div class="flex justify-between font-bold text-indigo-700 text-base">
                    <span>ç›®å‰ç¸½åƒ¹å€¼</span>
                    <span id="marketValue">$0</span>
                </div>
            </div>
        </div>

        <!-- Tab å°è¦½ -->
        <div class="sticky top-[75px] z-20 bg-slate-50/80 backdrop-blur-md py-2">
            <div class="flex bg-white p-1.5 rounded-2xl shadow-sm overflow-x-auto no-scrollbar justify-between border border-slate-100">
                <button onclick="switchTab('records')" id="tab-records" class="tab-btn flex-1 text-center">äº¤æ˜“</button>
                <button onclick="switchTab('dividends')" id="tab-dividends" class="tab-btn flex-1 text-center">é…æ¯</button>
                <button onclick="switchTab('interest')" id="tab-interest" class="tab-btn flex-1 text-center">åˆ©æ¯</button>
                <button onclick="switchTab('overseas')" id="tab-overseas" class="tab-btn flex-1 text-center">åœ‹å¤–</button>
                <button onclick="switchTab('reports')" id="tab-reports" class="tab-btn flex-1 text-center">å ±è¡¨</button>
            </div>
        </div>

        <!-- å…§å®¹æ¸²æŸ“å€ -->
        <div id="recordsView" class="space-y-3"></div>
        <div id="dividendsView" class="hidden space-y-3"></div>
        <div id="interestView" class="hidden space-y-3"></div>
        <div id="overseasView" class="hidden space-y-3"></div>
        <div id="reportsView" class="hidden space-y-3"></div>
    </div>

    <!-- åº•éƒ¨æµ®å‹•æŒ‰éˆ• (Theme Blue) -->
    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/80 backdrop-blur-xl border-t border-slate-100 z-40 safe-area-bottom">
        <div class="max-w-md mx-auto">
            <button onclick="openModal()" class="w-full bg-theme-blue text-white font-bold py-4 rounded-2xl shadow-lg shadow-blue-100 active:scale-95 transition-transform">
                ï¼‹ æ–°å¢æ•¸æ“šç´€éŒ„
            </button>
        </div>
    </div>

    <!-- æ–°å¢ç´€éŒ„å½ˆçª— -->
    <div id="modal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden items-end sm:items-center justify-center z-50">
        <div class="bg-white w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] p-8 modal-animate">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black">æ–°å¢æ•¸æ“š</h3>
                <button onclick="closeModal()" class="text-slate-400 text-2xl p-2">&times;</button>
            </div>
            <div class="space-y-4">
                <input type="hidden" id="editRecordId">
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-bold text-slate-400 mb-1 ml-1">åœ°å€</label>
                        <select id="location" onchange="toggleFields()" class="w-full bg-slate-100 p-4 rounded-2xl border-none font-medium text-slate-700">
                            <option value="domestic">ğŸ  åœ‹å…§</option>
                            <option value="overseas">ğŸŒ åœ‹å¤–</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 mb-1 ml-1">é¡å‹</label>
                        <select id="type" onchange="toggleFields()" class="w-full bg-slate-100 p-4 rounded-2xl border-none font-medium text-slate-700">
                            <option value="buy">ğŸ”µ è²·å…¥</option>
                            <option value="sell">ğŸ”´ è³£å‡º</option>
                            <option value="div">ğŸ’° é…æ¯</option>
                            <option value="loan">ğŸ¦ è³ªæŠ¼</option>
                            <option value="interest_expense">â– åˆ©æ¯æ”¯å‡º</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-bold text-slate-400 mb-1 ml-1">æ—¥æœŸ</label>
                        <input type="date" id="date" class="w-full bg-slate-100 p-4 rounded-2xl border-none">
                    </div>
                    <div id="amountGroup">
                        <label class="block text-xs font-bold text-slate-400 mb-1 ml-1">å¼µæ•¸</label>
                        <input type="number" id="amount" inputmode="decimal" placeholder="0" class="w-full bg-slate-100 p-4 rounded-2xl border-none">
                    </div>
                </div>

                <div>
                    <label id="priceLabel" class="block text-xs font-bold text-slate-400 mb-1 ml-1">å–®åƒ¹/é‡‘é¡</label>
                    <input type="number" id="price" inputmode="decimal" placeholder="è¼¸å…¥æ•¸å€¼" class="w-full bg-slate-100 p-4 rounded-2xl border-none text-lg font-bold">
                </div>

                <div id="rateGroup" class="hidden">
                    <label class="block text-xs font-bold text-slate-400 mb-1 ml-1">å¹´åˆ©ç‡ (%)</label>
                    <input type="number" id="rate" step="0.01" inputmode="decimal" placeholder="2.15" class="w-full bg-slate-100 p-4 rounded-2xl border-none">
                </div>

                <button onclick="save()" class="w-full bg-theme-blue text-white font-black py-5 rounded-2xl shadow-xl mt-4">å„²å­˜ç´€éŒ„</button>
            </div>
        </div>
    </div>

    <!-- è¨­å®šå½ˆçª— -->
    <div id="settingsModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md hidden items-center justify-center z-50 p-6">
        <div class="bg-white w-full max-w-xs rounded-[2.5rem] p-8 shadow-2xl">
            <h3 class="text-xl font-black mb-6 text-center">æ•¸æ“šç®¡ç†</h3>
            <div class="space-y-3">
                <button onclick="exportData()" class="w-full bg-slate-50 text-slate-700 font-bold py-4 rounded-2xl border border-slate-100">åŒ¯å‡ºå‚™ä»½ (JSON)</button>
                <label for="importJsonFile" class="w-full bg-emerald-50 text-emerald-700 font-bold py-4 rounded-2xl text-center block cursor-pointer">åŒ¯å…¥é‚„åŸ (JSON)</label>
                <input type="file" id="importJsonFile" accept=".json" onchange="importData(event)" class="hidden">
                <button onclick="resetData()" class="w-full bg-rose-50 text-rose-700 font-bold py-4 rounded-2xl">æ¸…ç©ºè³‡æ–™</button>
                <button onclick="closeSettingsModal()" class="w-full text-slate-400 pt-4 font-medium text-center block">é—œé–‰</button>
            </div>
        </div>
    </div>

    <!-- å¸‚åƒ¹å½ˆçª— -->
    <div id="priceModal" class="fixed inset-0 bg-slate-900/60 backdrop-blur-md hidden items-center justify-center z-50 p-6">
        <div class="bg-white w-full max-w-xs rounded-[2rem] p-6 shadow-2xl">
            <h3 class="font-black mb-2 text-slate-800">æ›´æ–°å¸‚åƒ¹</h3>
            <p class="text-xs text-slate-400 mb-4">è¼¸å…¥ 00720B æœ€æ–°å¸‚å ´åƒ¹æ ¼</p>
            <input type="number" id="manualPriceInput" inputmode="decimal" step="0.01" class="w-full bg-slate-100 p-4 rounded-2xl mb-4 text-xl font-bold text-indigo-600">
            <div class="flex gap-2">
                <button onclick="closePriceModal()" class="flex-1 bg-slate-100 text-slate-500 font-bold py-3 rounded-xl">å–æ¶ˆ</button>
                <button onclick="saveManualPrice()" class="flex-1 bg-theme-blue text-white font-bold py-3 rounded-xl">æ›´æ–°</button>
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–
        let db = [];
        try {
            const saved = localStorage.getItem('bond_v2026');
            db = saved ? JSON.parse(saved) : [];
        } catch(e) { db = []; }

        let CURRENT_MARKET_PRICE = localStorage.getItem('current_market_price_v2026') ? parseFloat(localStorage.getItem('current_market_price_v2026')) : 33.66;
        const SHARE_MULTIPLIER = 1000;
        let activeTab = 'records';

        function openSettingsModal() { document.getElementById('settingsModal').classList.remove('hidden'); document.getElementById('settingsModal').classList.add('flex'); }
        function closeSettingsModal() { document.getElementById('settingsModal').classList.add('hidden'); document.getElementById('settingsModal').classList.remove('flex'); }
        function openPriceModal() { document.getElementById('manualPriceInput').value = CURRENT_MARKET_PRICE; document.getElementById('priceModal').classList.remove('hidden'); document.getElementById('priceModal').classList.add('flex'); }
        function closePriceModal() { document.getElementById('priceModal').classList.add('hidden'); document.getElementById('priceModal').classList.remove('flex'); }
        
        function saveManualPrice() {
            const val = parseFloat(document.getElementById('manualPriceInput').value);
            if (val > 0) { 
                CURRENT_MARKET_PRICE = val; 
                localStorage.setItem('current_market_price_v2026', val); 
                closePriceModal(); 
                render(); 
            }
        }

        function toggleFields() {
            const type = document.getElementById('type').value;
            const location = document.getElementById('location').value;
            const amountGroup = document.getElementById('amountGroup');
            const rateGroup = document.getElementById('rateGroup');
            const priceLabel = document.getElementById('priceLabel');
            if(rateGroup) rateGroup.classList.toggle('hidden', type !== 'loan');
            if (location === 'overseas' || (type !== 'buy' && type !== 'sell')) {
                if(amountGroup) amountGroup.classList.add('hidden');
                if(priceLabel) priceLabel.innerText = "ç¸½é‡‘é¡ (USD/TWD)";
            } else {
                if(amountGroup) amountGroup.classList.remove('hidden');
                if(priceLabel) priceLabel.innerText = "æˆäº¤å–®åƒ¹";
            }
        }

        function openModal() {
            document.getElementById('editRecordId').value = '';
            document.getElementById('date').valueAsDate = new Date();
            document.getElementById('amount').value = '';
            document.getElementById('price').value = '';
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal').classList.add('flex');
            toggleFields();
        }

        function closeModal() { 
            document.getElementById('modal').classList.add('hidden'); 
            document.getElementById('modal').classList.remove('flex');
            document.activeElement.blur(); 
        }

        function save() {
            const id = document.getElementById('editRecordId').value;
            const data = {
                id: id ? parseInt(id) : Date.now(),
                location: document.getElementById('location').value,
                type: document.getElementById('type').value,
                date: document.getElementById('date').value,
                amount: parseFloat(document.getElementById('amount').value) || 0,
                price: parseFloat(document.getElementById('price').value) || 0,
                rate: parseFloat(document.getElementById('rate').value) || 0
            };
            if (id) {
                const idx = db.findIndex(r => r.id === parseInt(id));
                if(idx !== -1) db[idx] = data;
            } else {
                db.push(data);
            }
            localStorage.setItem('bond_v2026', JSON.stringify(db));
            closeModal();
            render();
        }

        function remove(id) { if(confirm('ç¢ºå®šåˆªé™¤æ­¤ç´€éŒ„ï¼Ÿ')) { db = db.filter(r => r.id !== id); localStorage.setItem('bond_v2026', JSON.stringify(db)); render(); } }

        function editRecord(id) {
            const r = db.find(item => item.id === id);
            if (!r) return;
            openModal();
            document.getElementById('editRecordId').value = r.id;
            document.getElementById('location').value = r.location;
            document.getElementById('type').value = r.type;
            document.getElementById('date').value = r.date;
            document.getElementById('amount').value = r.amount;
            document.getElementById('price').value = r.price;
            document.getElementById('rate').value = r.rate || 0;
            toggleFields();
        }

        function switchTab(tabId) {
            activeTab = tabId;
            ['recordsView', 'dividendsView', 'interestView', 'overseasView', 'reportsView'].forEach(v => {
                const el = document.getElementById(v);
                if(el) el.classList.add('hidden');
            });
            const activeView = document.getElementById(tabId + 'View');
            if(activeView) activeView.classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            const activeTabBtn = document.getElementById('tab-' + tabId);
            if(activeTabBtn) activeTabBtn.classList.add('active');
            render();
        }

        function getChineseType(t) {
            const m = { 'buy':'è²·å…¥', 'sell':'è³£å‡º', 'div':'é…æ¯', 'loan':'è³ªæŠ¼', 'interest_expense':'åˆ©æ¯æ”¯å‡º' };
            return m[t] || t;
        }

        function render() {
            let domesticBonds = 0, domesticCost = 0, overseasValue = 0, totalDiv = 0, totalInt = 0;
            const now = new Date();
            db.forEach(i => {
                const isDomestic = (i.location || 'domestic') === 'domestic';
                if (isDomestic) {
                    if (i.type === 'buy') { domesticBonds += i.amount; domesticCost += (i.price * i.amount * SHARE_MULTIPLIER); }
                    if (i.type === 'sell') { domesticBonds -= i.amount; domesticCost -= (i.price * i.amount * SHARE_MULTIPLIER); }
                } else {
                    if (i.type === 'buy') overseasValue += i.price;
                    if (i.type === 'sell') overseasValue -= i.price;
                }
                if (i.type === 'div') totalDiv += i.price;
                if (i.type === 'interest_expense') totalInt += i.price;
                if (i.type === 'loan') {
                    const loanDate = new Date((i.date || "").replace(/-/g, '/'));
                    const days = Math.max(0, (now - loanDate) / 86400000);
                    totalInt += (i.price * (i.rate / 100) * (days / 365));
                }
            });

            const marketVal = (domesticBonds * CURRENT_MARKET_PRICE * SHARE_MULTIPLIER) + overseasValue;
            const pl = (marketVal - domesticCost) + totalDiv - totalInt;

            const safeSetText = (id, txt) => { const el = document.getElementById(id); if(el) el.innerText = txt; };
            safeSetText('totalBonds', domesticBonds.toLocaleString());
            const plEl = document.getElementById('totalProfitLoss');
            if(plEl) {
                plEl.innerText = (pl >= 0 ? '+' : '') + '$' + Math.round(pl).toLocaleString();
                plEl.className = `text-3xl font-black ${pl >= 0 ? 'text-indigo-600' : 'text-rose-500'}`;
            }
            safeSetText('domesticPriceDisplay', '$' + CURRENT_MARKET_PRICE.toFixed(2));
            safeSetText('totalOverseasValueDisplay', '$' + Math.round(overseasValue).toLocaleString());
            safeSetText('totalDividends', '$' + Math.round(totalDiv).toLocaleString());
            safeSetText('totalInterest', '-$' + Math.round(totalInt).toLocaleString());
            safeSetText('totalCost', '$' + Math.round(domesticCost).toLocaleString());
            safeSetText('marketValue', '$' + Math.round(marketVal).toLocaleString());
            renderList();
        }

        function renderList() {
            const container = document.getElementById(activeTab + 'View');
            if (!container) return;
            container.innerHTML = '';
            if (activeTab === 'reports') { renderReports(); return; }

            let list = [...db].sort((a,b) => new Date((b.date||"").replace(/-/g, '/')) - new Date((a.date||"").replace(/-/g, '/')));
            if (activeTab === 'records') list = list.filter(i => i.type === 'buy' || i.type === 'sell');
            else if (activeTab === 'dividends') list = list.filter(i => i.type === 'div');
            else if (activeTab === 'interest') list = list.filter(i => i.type === 'loan' || i.type === 'interest_expense');
            else if (activeTab === 'overseas') list = list.filter(i => i.location === 'overseas');

            list.forEach(i => {
                const card = document.createElement('div');
                card.className = "bg-white p-5 rounded-[1.5rem] shadow-sm flex flex-col gap-3 border border-slate-50";
                const typeColor = (i.type === 'buy' || i.type === 'div') ? 'text-emerald-600' : (i.type === 'sell' || i.type === 'interest_expense' ? 'text-rose-600' : 'text-indigo-600');
                const locTag = i.location === 'overseas' ? '<span class="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded-full ml-2">åœ‹å¤–</span>' : '<span class="text-[10px] bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded-full ml-2">åœ‹å…§</span>';
                let detail = i.type === 'loan' ? `æœ¬é‡‘: $${i.price.toLocaleString()} (@${i.rate}%)` : (i.amount > 0 ? `${i.amount}å¼µ / $${i.price}` : `é‡‘é¡: $${i.price.toLocaleString()}`);

                card.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="flex items-center font-bold ${typeColor}">${getChineseType(i.type)} ${locTag}</div>
                            <div class="text-[11px] text-slate-400 mt-1">${i.date}</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editRecord(${i.id})" class="bg-slate-50 text-indigo-600 text-xs px-3 py-2 rounded-lg font-bold">ç·¨è¼¯</button>
                            <button onclick="remove(${i.id})" class="bg-slate-50 text-rose-400 text-xs px-3 py-2 rounded-lg font-bold">åˆªé™¤</button>
                        </div>
                    </div>
                    <div class="text-sm font-medium text-slate-600 bg-slate-50/50 p-3 rounded-xl">${detail}</div>
                `;
                container.appendChild(card);
            });
        }

        function renderReports() {
            const view = document.getElementById('reportsView');
            if(!view) return;
            view.innerHTML = '';
            const years = db.reduce((acc, i) => {
                const y = (i.date || "0000").split('-')[0];
                if (!acc[y]) acc[y] = { buy:0, sell:0, div:0, int:0 };
                const val = (i.location === 'domestic' && i.amount) ? (i.price * i.amount * SHARE_MULTIPLIER) : i.price;
                if (i.type === 'buy') acc[y].buy += val;
                else if (i.type === 'sell') acc[y].sell += val;
                else if (i.type === 'div') acc[y].div += val;
                else if (i.type === 'interest_expense' || i.type === 'loan') {
                   if (i.type === 'interest_expense') acc[y].int += i.price;
                   if (i.type === 'loan') {
                      const days = Math.max(0, (new Date() - new Date(i.date.replace(/-/g, '/'))) / 86400000);
                      acc[y].int += (i.price * (i.rate / 100) * (days / 365));
                   }
                }
                return acc;
            }, {});

            Object.keys(years).sort((a,b)=>b-a).forEach(y => {
                const d = years[y];
                const card = document.createElement('div');
                card.className = "bg-white p-6 rounded-[2rem] shadow-sm border border-indigo-50 mb-4";
                card.innerHTML = `
                    <h3 class="font-black text-indigo-700 mb-4 text-lg">${y} å¹´åº¦çµ±è¨ˆ</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm font-medium">
                        <div class="bg-slate-50 p-3 rounded-2xl"><p class="text-slate-400 text-[10px] mb-1">ç¸½è²·å…¥</p>$${Math.round(d.buy).toLocaleString()}</div>
                        <div class="bg-slate-50 p-3 rounded-2xl"><p class="text-slate-400 text-[10px] mb-1">ç¸½è³£å‡º</p>$${Math.round(d.sell).toLocaleString()}</div>
                        <div class="bg-emerald-50 p-3 rounded-2xl text-emerald-700"><p class="text-emerald-600/50 text-[10px] mb-1">é…æ¯æ”¶å…¥</p>$${Math.round(d.div).toLocaleString()}</div>
                        <div class="bg-rose-50 p-3 rounded-2xl text-rose-700"><p class="text-rose-600/50 text-[10px] mb-1">åˆ©æ¯æ”¯å‡º</p>$${Math.round(d.int).toLocaleString()}</div>
                    </div>
                `;
                view.appendChild(card);
            });
        }

        function exportData() {
            const blob = new Blob([JSON.stringify(db, null, 2)], {type: 'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
            a.download = `bonds_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        function importData(e) {
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    db = JSON.parse(event.target.result);
                    localStorage.setItem('bond_v2026', JSON.stringify(db));
                    render(); closeSettingsModal(); alert('åŒ¯å…¥æˆåŠŸ');
                } catch(err) { alert('æª”æ¡ˆæ ¼å¼éŒ¯èª¤'); }
            };
            if(e.target.files[0]) reader.readAsText(e.target.files[0]);
        }

        function resetData() { if(confirm('ç¢ºå®šæ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼Ÿ')) { db = []; localStorage.removeItem('bond_v2026'); render(); closeSettingsModal(); } }

        window.onload = () => { render(); switchTab('records'); };
    </script>
</body>
</html>